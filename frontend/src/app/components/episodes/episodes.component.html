<section class="episodes-container">

  <!-- ========================= -->
  <!-- TÍTULO -->
  <!-- ========================= -->
  <h2>
    Episodios (página {{ page() }} de {{ totalPages() }})
  </h2>

  <!-- ========================= -->
  <!-- FILTROS DE BÚSQUEDA -->
  <!-- ========================= -->
  <div class="filters">

    <input
      type="text"
      placeholder="Buscar por nombre del episodio"
      [disabled]="loading()"
      [ngModel]="filterName()"
      (ngModelChange)="filterName.set($event)"
    />

    <input
      type="text"
      placeholder="Buscar por temporada (S01, S02...)"
      [disabled]="loading()"
      [ngModel]="filterSeason()"
      (ngModelChange)="filterSeason.set($event)"
    />

    <input
      type="text"
      placeholder="Buscar por fecha de emisión"
      [disabled]="loading()"
      [ngModel]="filterAirDate()"
      (ngModelChange)="filterAirDate.set($event)"
    />

    <input
      type="text"
      placeholder="Buscar por personaje"
      [disabled]="loading()"
      [ngModel]="filterCharacter()"
      (ngModelChange)="filterCharacter.set($event)"
    />

  </div>

  <!-- Botón limpiar filtros -->
  <div class="filters-actions">
    <button
      type="button"
      (click)="limpiarFiltros()"
      [disabled]="loading()">
      Limpiar filtros
    </button>
  </div>

  <!-- ========================= -->
  <!-- ESTADO DE CARGA -->
  <!-- ========================= -->
  <div *ngIf="loading()" class="loading">
    Cargando episodios...
  </div>

  <!-- ========================= -->
  <!-- MENSAJE DE ERROR -->
  <!-- ========================= -->
  <app-error
    *ngIf="error()"
    [mensaje]="error()">
  </app-error>

  <!-- ========================= -->
  <!-- SIN RESULTADOS -->
  <!-- ========================= -->
  <div
    *ngIf="!loading() && !error() && filteredEpisodes.length === 0"
    class="no-results">
    No se encontraron episodios con los filtros aplicados.
  </div>

  <!-- ========================= -->
  <!-- LISTA DE EPISODIOS -->
  <!-- ========================= -->
  <ul *ngIf="filteredEpisodes.length > 0">

    <li *ngFor="let e of filteredEpisodes" class="episode-card">

      <h3>{{ e.name }}</h3>

      <p class="episode-info">
        {{ e.episode }} — {{ formatFecha(e.airDate) }}
      </p>

      <!-- ========================= -->
      <!-- PERSONAJES -->
      <!-- ========================= -->
      <div
        *ngIf="e.characters?.length"
        class="characters-container">

        <h4>Personajes</h4>

        <div class="characters-grid">

          <div
            class="character-card"
            *ngFor="let c of e.characters">

            <img
              [src]="c.image"
              [alt]="c.name"
            />

            <span>{{ c.name }}</span>

          </div>
        </div>
      </div>

    </li>

  </ul>

  <!-- ========================= -->
  <!-- PAGINACIÓN -->
  <!-- ========================= -->
  <div class="pagination">

    <button
      (click)="prev()"
      [disabled]="page() <= 1 || loading()">
      Anterior
    </button>

    <button
      (click)="next()"
      [disabled]="page() >= totalPages() || loading()">
      Siguiente
    </button>

  </div>

</section>
